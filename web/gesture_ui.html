<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kenza Gesture Control</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            overflow: hidden;
            color: #fff;
        }

        /* Gesture Cursor */
        #cursor {
            position: fixed;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            border: 3px solid #fff;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 10000;
            transition: all 0.1s ease-out;
        }

        #cursor.clicking {
            background: rgba(0, 255, 100, 0.8);
            transform: translate(-50%, -50%) scale(1.3);
            box-shadow: 0 0 30px rgba(0, 255, 100, 0.6);
        }

        #cursor.dragging {
            background: rgba(255, 100, 0, 0.8);
            border-color: #ff6600;
            width: 40px;
            height: 40px;
        }

        #cursor.pointing {
            width: 20px;
            height: 20px;
            background: rgba(100, 200, 255, 0.8);
        }

        /* Header */
        header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2rem;
        }

        /* Status Bar */
        #status-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            font-size: 1.1rem;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #666;
        }

        .status-dot.connected {
            background: #4caf50;
        }

        #gesture-display {
            font-size: 1.3rem;
            color: #4fc3f7;
            font-weight: bold;
        }

        /* Main Content */
        main {
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
        }

        /* Button Grid */
        .button-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            max-width: 600px;
        }

        .gesture-btn {
            width: 150px;
            height: 100px;
            border: none;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .gesture-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0);
            transition: background 0.2s;
        }

        .gesture-btn.hovered::before {
            background: rgba(255, 255, 255, 0.2);
        }

        .gesture-btn.clicked {
            transform: scale(0.95);
            box-shadow: 0 0 30px currentColor;
        }

        .gesture-btn.clicked::after {
            content: '‚úì';
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 1.5rem;
        }

        .btn-red {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: #fff;
        }

        .btn-green {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: #fff;
        }

        .btn-blue {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: #fff;
        }

        .btn-yellow {
            background: linear-gradient(135deg, #f39c12, #d68910);
            color: #fff;
        }

        .btn-purple {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: #fff;
        }

        .btn-pink {
            background: linear-gradient(135deg, #e91e63, #c2185b);
            color: #fff;
        }

        /* Slider Demo */
        .slider-demo {
            width: 400px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        .slider-demo h3 {
            margin-bottom: 15px;
        }

        .slider-track {
            height: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            position: relative;
        }

        .slider-handle {
            width: 40px;
            height: 40px;
            background: #4fc3f7;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
            transition: left 0.1s;
        }

        .slider-handle.dragging {
            background: #ff6600;
            box-shadow: 0 0 20px rgba(255, 102, 0, 0.8);
        }

        /* Connection Panel */
        .connect-panel {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        input {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 1rem;
            width: 200px;
        }

        button.connect-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #4caf50;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
        }

        button.connect-btn:hover {
            background: #45a049;
        }

        /* Instructions */
        .instructions {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            max-width: 500px;
        }
    </style>
</head>

<body>
    <!-- Gesture Cursor -->
    <div id="cursor"></div>

    <header>
        <h1>ü§ñ Kenza Gesture Control</h1>
    </header>

    <div id="status-bar">
        <div class="status-item">
            <div class="status-dot" id="connection-dot"></div>
            <span id="connection-status">Disconnected</span>
        </div>
        <div class="status-item">
            <span>Gesture:</span>
            <span id="gesture-display">None</span>
        </div>
        <div class="status-item">
            <span>Action:</span>
            <span id="action-display">-</span>
        </div>
    </div>

    <main>
        <div class="connect-panel">
            <input type="text" id="pi-ip" placeholder="Pi IP (e.g., 192.168.1.50)">
            <button class="connect-btn" onclick="connect()">Connect</button>
            <button class="connect-btn" onclick="simulateMode()" style="background: #ff9800;">Simulate</button>
        </div>

        <div class="button-grid">
            <button class="gesture-btn btn-red" data-action="Robot Wave">üëã Wave</button>
            <button class="gesture-btn btn-green" data-action="Happy Face">üòä Happy</button>
            <button class="gesture-btn btn-blue" data-action="Follow Mode">üö∂ Follow</button>
            <button class="gesture-btn btn-yellow" data-action="Dance">üíÉ Dance</button>
            <button class="gesture-btn btn-purple" data-action="Sleep Mode">üò¥ Sleep</button>
            <button class="gesture-btn btn-pink" data-action="Speak">üó£Ô∏è Speak</button>
        </div>

        <div class="slider-demo">
            <h3>üéöÔ∏è Drag Test (Use Fist)</h3>
            <div class="slider-track">
                <div class="slider-handle" id="slider-handle" style="left: 50%;"></div>
            </div>
        </div>

        <div class="instructions">
            <p><strong>Gestures:</strong></p>
            <p>üñêÔ∏è Open Palm = Move cursor | ü§è Pinch = Click | ‚úä Fist = Drag</p>
        </div>
    </main>

    <script>
        let ws = null;
        let simulationMode = false;
        let cursorX = window.innerWidth / 2;
        let cursorY = window.innerHeight / 2;
        let isDragging = false;
        let hoveredElement = null;
        let sliderDragging = false;

        const cursor = document.getElementById('cursor');
        const buttons = document.querySelectorAll('.gesture-btn');
        const sliderHandle = document.getElementById('slider-handle');

        // Update cursor position
        function updateCursor(x, y, gesture, action) {
            cursorX = x * window.innerWidth;
            cursorY = y * window.innerHeight;

            cursor.style.left = cursorX + 'px';
            cursor.style.top = cursorY + 'px';

            // Update cursor style based on action
            cursor.className = '';
            if (action === 'click') cursor.classList.add('clicking');
            else if (action === 'dragging' || action === 'drag_start') cursor.classList.add('dragging');
            else if (gesture.includes('Point')) cursor.classList.add('pointing');

            // Update status display
            document.getElementById('gesture-display').textContent = gesture;
            document.getElementById('action-display').textContent = action;

            // Handle interactions
            handleInteraction(cursorX, cursorY, action, gesture);
        }

        function handleInteraction(x, y, action, gesture) {
            // Check button hover/click
            buttons.forEach(btn => {
                const rect = btn.getBoundingClientRect();
                const isOver = x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom;

                btn.classList.remove('hovered', 'clicked');

                if (isOver) {
                    btn.classList.add('hovered');

                    if (action === 'click') {
                        btn.classList.add('clicked');
                        triggerAction(btn.dataset.action);
                    }
                }
            });

            // Handle slider drag
            const sliderTrack = document.querySelector('.slider-track');
            const trackRect = sliderTrack.getBoundingClientRect();

            if (action === 'drag_start' || action === 'dragging') {
                // Check if over slider
                if (y >= trackRect.top - 30 && y <= trackRect.bottom + 30) {
                    sliderDragging = true;
                    sliderHandle.classList.add('dragging');

                    // Update slider position
                    let sliderX = ((x - trackRect.left) / trackRect.width) * 100;
                    sliderX = Math.max(0, Math.min(100, sliderX));
                    sliderHandle.style.left = sliderX + '%';
                }
            } else if (action === 'drag_end' || action === 'hover') {
                sliderDragging = false;
                sliderHandle.classList.remove('dragging');
            }
        }

        function triggerAction(actionName) {
            console.log('Action triggered:', actionName);
            // Here you would send command to robot
        }

        // WebSocket Connection
        function connect() {
            const ip = document.getElementById('pi-ip').value.trim();
            if (!ip) {
                alert('Enter Pi IP address');
                return;
            }

            const url = `ws://${ip}:8765`;
            console.log('Connecting to', url);

            try {
                ws = new WebSocket(url);

                ws.onopen = () => {
                    document.getElementById('connection-dot').classList.add('connected');
                    document.getElementById('connection-status').textContent = 'Connected';
                };

                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    updateCursor(data.x, data.y, data.gesture, data.action);
                };

                ws.onclose = () => {
                    document.getElementById('connection-dot').classList.remove('connected');
                    document.getElementById('connection-status').textContent = 'Disconnected';
                };

                ws.onerror = (err) => {
                    console.error('WebSocket error:', err);
                };
            } catch (e) {
                console.error('Connection failed:', e);
            }
        }

        // Simulation Mode (for testing without Pi)
        function simulateMode() {
            simulationMode = true;
            document.getElementById('connection-dot').classList.add('connected');
            document.getElementById('connection-status').textContent = 'Simulation';

            // Track mouse as gesture
            document.addEventListener('mousemove', (e) => {
                if (simulationMode) {
                    const x = e.clientX / window.innerWidth;
                    const y = e.clientY / window.innerHeight;
                    updateCursor(x, y, 'Open Palm', 'hover');
                }
            });

            // Click = Pinch
            document.addEventListener('mousedown', (e) => {
                if (simulationMode) {
                    const x = e.clientX / window.innerWidth;
                    const y = e.clientY / window.innerHeight;
                    updateCursor(x, y, 'Pinch', 'click');
                }
            });

            // Right-click = Fist (drag)
            document.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                if (simulationMode) {
                    const x = e.clientX / window.innerWidth;
                    const y = e.clientY / window.innerHeight;
                    updateCursor(x, y, 'Closed Fist', 'drag_start');
                }
            });
        }

        // Initial cursor position
        cursor.style.left = cursorX + 'px';
        cursor.style.top = cursorY + 'px';
    </script>
</body>

</html>